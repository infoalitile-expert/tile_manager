<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ali Tile Manager</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js"></script>
<style>
  * {margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
  body {background:#f4f4f4;color:#222;}
  header {background:#1a73e8;color:#fff;padding:15px;text-align:center;font-weight:600;font-size:1.3em;}
  .container {max-width:600px;margin:20px auto;background:#fff;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,0.1);padding:20px;}
  input,button,select {width:100%;padding:10px;margin:8px 0;border:1px solid #ccc;border-radius:8px;font-size:15px;}
  button {background:#1a73e8;color:white;border:none;cursor:pointer;transition:0.3s;}
  button:hover {background:#0f5ad3;}
  .hidden {display:none;}
  .dashboard {margin-top:15px;}
  .payment-list {background:#eef5ff;border-radius:8px;padding:10px;margin-top:10px;}
  .payment-item {padding:5px 0;border-bottom:1px solid #ddd;}
  .footer {text-align:center;margin-top:30px;font-size:14px;color:#555;}
  .footer a {color:#1a73e8;text-decoration:none;}
  @media(max-width:480px){header{font-size:1.1em;}}
</style>
</head>
<body>
<header>Ali Tile Manager</header>

<div class="container" id="loginDiv">
  <h2 style="text-align:center;">Login</h2>
  <input type="email" id="email" placeholder="Enter Email" />
  <input type="password" id="password" placeholder="Enter Password" />
  <button id="loginBtn">Login</button>
  <p style="text-align:center;margin-top:10px;">Use your unique ID provided by admin</p>
</div>

<div class="container hidden" id="dashboardDiv">
  <h2 id="userTypeHeading">Dashboard</h2>
  <div id="userDetails"></div>
  
  <div class="dashboard">
    <h3>Payments</h3>
    <button id="addPaymentBtn">Add Payment</button>
    <div id="paymentSection"></div>
  </div>
  
  <button id="logoutBtn" style="background:#e53935;">Logout</button>
</div>

<div class="footer">
  <p>üìç Khatakheri, Saharanpur (UP) 247001 | üìû <a href="https://wa.me/919627136607" target="_blank">WhatsApp: 9627136607</a></p>
  <p>üáÆüá≥ Designed for Indian Tiling Professionals</p>
</div>
<!-- Firebase App (core SDK) -->
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app-compat.js"></script>

<!-- Firebase Authentication -->
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-auth-compat.js"></script>

<!-- Firebase Firestore -->
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore-compat.js"></script>

<script>
 // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyC_WmdR-NTEh1LXvVMU7H-ehH_yecWzbJw",
  authDomain: "ali-tile-manager.firebaseapp.com",
  projectId: "ali-tile-manager",
  storageBucket: "ali-tile-manager.firebasestorage.app",
  messagingSenderId: "108065859153",
  appId: "1:108065859153:web:922b8f628e4777ace03a70",
  measurementId: "G-TMX27XC1F4"
};
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  const loginDiv = document.getElementById('loginDiv');
  const dashboardDiv = document.getElementById('dashboardDiv');
  const userDetails = document.getElementById('userDetails');
  const paymentSection = document.getElementById('paymentSection');
  const userTypeHeading = document.getElementById('userTypeHeading');

  document.getElementById('loginBtn').onclick = async () => {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    try {
      const userCred = await auth.signInWithEmailAndPassword(email, password);
      loadDashboard(userCred.user.uid);
    } catch (err) {
      alert("Login failed: " + err.message);
    }
  };

  document.getElementById('logoutBtn').onclick = () => {
    auth.signOut();
    dashboardDiv.classList.add('hidden');
    loginDiv.classList.remove('hidden');
  };

  async function loadDashboard(uid) {
    const docRef = db.collection('users').doc(uid);
    const docSnap = await docRef.get();
    if (!docSnap.exists) {
      alert("User data not found!");
      return;
    }
    const data = docSnap.data();
    loginDiv.classList.add('hidden');
    dashboardDiv.classList.remove('hidden');
    userTypeHeading.innerText = data.type === 'worker' ? "üë∑ Worker Dashboard" : "üèóÔ∏è Project Dashboard";
    userDetails.innerHTML = `
      <p><strong>Name:</strong> ${data.name}</p>
      <p><strong>Unique ID:</strong> ${data.uniqueId}</p>
      <p><strong>Email:</strong> ${data.email}</p>
    `;
    loadPayments(uid);
  }

  async function loadPayments(uid) {
    paymentSection.innerHTML = "<p>Loading payments...</p>";
    const snap = await db.collection('users').doc(uid).collection('payments').orderBy('date', 'desc').get();
    if (snap.empty) {
      paymentSection.innerHTML = "<p>No payments recorded yet.</p>";
      return;
    }
    let total = 0;
    let html = '<div class="payment-list">';
    snap.forEach(doc => {
      const p = doc.data();
      total += parseFloat(p.amount);
      html += `
        <div class="payment-item">
          <b>‚Çπ${p.amount}</b> - ${p.date}<br/>
          <small>${p.note || ''}</small>
        </div>`;
    });
    html += `<div style="margin-top:10px;font-weight:600;">Total: ‚Çπ${total}</div></div>`;
    paymentSection.innerHTML = html;
  }

  document.getElementById('addPaymentBtn').onclick = async () => {
    const user = auth.currentUser;
    if (!user) return;
    const amount = prompt("Enter payment amount (‚Çπ):");
    if (!amount) return;
    const note = prompt("Enter note or project detail:");
    await db.collection('users').doc(user.uid).collection('payments').add({
      amount: parseFloat(amount),
      note: note,
      date: new Date().toLocaleDateString('en-IN')
    });
    alert("Payment added!");
    loadPayments(user.uid);
  };

  auth.onAuthStateChanged(user => {
    if (user) loadDashboard(user.uid);
  });
</script>
</body>
</html>
